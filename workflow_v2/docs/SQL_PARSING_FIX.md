# SQL Parsing Fix

## Issue Identified
The tree orchestrator was failing because SQL queries were returning empty results, causing the SQL Evaluator to rate them as "poor" quality.

## Root Cause
In `sql_generator_agent.py`, the SQL cleaning code was using:
```python
result["sql"] = re.sub(r'\s+', ' ', result["sql"]).strip()
```

This regex was collapsing **all whitespace including newlines** into single spaces, which caused:

1. SQL comments and actual SQL to be merged on the same line
2. The entire line to be treated as a comment (starting with `--`)
3. No actual SQL being executed
4. Empty result sets leading to "poor" quality ratings

### Example of the Problem:
**Generated by LLM:**
```sql
-- SQL query to find the highest percentage
SELECT MAX(column) FROM table WHERE condition
```

**After regex cleaning:**
```sql
-- SQL query to find the highest percentage SELECT MAX(column) FROM table WHERE condition
```

**Result:** The entire line becomes a comment, no SQL executes.

## Solution
Updated the SQL cleaning logic to:

1. **Preserve line structure** by splitting on newlines first
2. **Remove comment lines** that start with `--`
3. **Clean whitespace within lines** but not across lines
4. **Rejoin only the actual SQL** without comments

### Fixed Code:
```python
# Clean up SQL (preserve line structure but remove extra whitespace)
if result["sql"]:
    # Split into lines, clean each line, then rejoin
    lines = result["sql"].split('\n')
    cleaned_lines = []
    for line in lines:
        line = line.strip()
        if line and not line.startswith('--'):  # Skip empty lines and comments
            # Clean internal whitespace but preserve line structure
            line = re.sub(r'\s+', ' ', line)
            cleaned_lines.append(line)
    
    result["sql"] = ' '.join(cleaned_lines).strip()
```

## Results
- ✅ Tests now pass consistently
- ✅ SQL queries execute properly and return data
- ✅ Tree orchestrator completes successfully with "excellent" quality ratings
- ✅ No more empty result sets due to comment-merged SQL

## Testing
All test cases now pass:
- `test_simple_query_success` ✅
- `test_count_query` ✅ 
- `test_aggregation_query` ✅
- Full test suite runs successfully ✅

This fix resolves the core issue that was preventing the tree orchestrator from completing successfully.